{"version":3,"sources":["SecuritySandbox.js","GameCard.js","GameCards.js","utils.js","index.js","Parent.js","Sandboxed.js"],"names":["SecuritySandbox","Parent","Sandboxed","useEffect","window","parent","respawnFrame","Component","document","querySelector","remove","iframe","createElement","id","allow","sandbox","src","location","href","body","prepend","useMessageHandler","handler","handleMessage","data","addEventListener","removeEventListener","sendMessage","message","contentWindow","postMessage","GameCard","app","name","developer","js","thumbnail","onPlay","Card","sx","maxWidth","margin","CardActionArea","onClick","CardMedia","height","width","image","CardContent","Typography","gutterBottom","variant","component","color","GameCards","apps","useLayoutEffect","getScrollTo","Grid","container","justifyContent","map","i","item","a","fetch","res","text","parse","filterApps","filter","hash","main","dev","runGame","isSecureContext","error","navigator","xr","isSessionSupported","requestSession","optionalFeatures","session","import","jsModule","default","renderer","setSession","Promise","ok","ReactDOM","render","StrictMode","useState","preloaderVisible","setPreloaderVisible","x","y","position","setPosition","load","unload","setScrollTo","className","Box","display","alignItems","CircularProgress","setApps","getApps","then","scrollTo","scrollX","scrollY","alert","getElementById"],"mappings":"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","file":"static/js/main.dc459cff.chunk.js","sourcesContent":["/* eslint-disable no-restricted-globals */\nimport React, { useEffect } from 'react';\n\nexport function SecuritySandbox({ Parent, Sandboxed }) {\n    useEffect(() => {\n        if (window.parent === window) {\n            respawnFrame();\n        }\n    }, []);\n\n    const Component = window.parent === window ? Parent : Sandboxed;\n\n    return <Component />;\n}\n\nexport function respawnFrame() {\n    document.querySelector('#security-sandbox-iframe')?.remove();\n\n    const iframe = document.createElement('iframe');\n\n    iframe.id = 'security-sandbox-iframe';\n    iframe.allow = 'xr-spatial-tracking';\n    iframe.sandbox = 'allow-scripts allow-modals'\n    iframe.src = window.location.href;\n\n    document.body.prepend(iframe);\n\n    return iframe;\n}\n\nexport function useMessageHandler(handler) {\n    useEffect(() => {\n        function handleMessage({ data }) {\n            handler(data);\n        }\n\n        window.addEventListener('message', handleMessage);\n        return () => window.removeEventListener('message', handleMessage);\n    }, [handler]);\n}\n\nexport function sendMessage(message) {\n    if (process.env.NODE_ENV === 'development') { return; }\n\n    const target = window.parent === window ? document.querySelector('#security-sandbox-iframe').contentWindow : window.parent;\n\n    target.postMessage(message, '*');\n}\n","import React from 'react';\nimport { Card, CardMedia, CardActionArea, CardContent, Typography } from '@material-ui/core';\n\nexport function GameCard({ app: { name, developer, js, thumbnail }, onPlay }) {\n    return (\n        <Card sx={{ maxWidth: 345, margin: \"12px\" }}>\n            <CardActionArea onClick={() => { onPlay(js) }}>\n                <CardMedia\n                    sx={{ height: 200, width: 300 }}\n                    image={thumbnail}\n                />\n                <CardContent>\n                    <Typography gutterBottom variant=\"h5\" component=\"div\">{name}</Typography>\n                    <Typography variant=\"body2\" color=\"text.secondary\">{developer}</Typography>\n                </CardContent>\n            </CardActionArea>\n        </Card>\n    )\n}\n","/* eslint-disable no-restricted-globals */\nimport React, { useLayoutEffect } from 'react';\nimport { Grid } from '@material-ui/core';\n\nimport { sendMessage } from './SecuritySandbox';\nimport { GameCard } from './GameCard';\n\nexport function GameCards({ apps, onPlay }) {\n    useLayoutEffect(() => {\n        sendMessage({ getScrollTo: true });\n    }, []);\n\n    return (<Grid container justifyContent=\"center\">{\n        apps.map((app, i) => <Grid item key={i}><GameCard app={app} onPlay={onPlay} /></Grid>)\n    }</Grid>);\n}\n","/* eslint-disable no-restricted-globals */\nimport { parse } from 'yaml';\n\nimport { appsStub } from './dev-sandboxed-apps.stub'\n\nexport async function getApps() {\n    if (process.env.NODE_ENV === 'development') {\n        return appsStub.apps;\n    }\n\n    const res = await fetch('/vr-apps-catalog/apps.yml'), text = await res.text();\n    return parse(text).apps;\n}\n\nexport function filterApps(apps) {\n    return apps.filter(\n        location.hash === '#dev' ?\n            (({ main, dev }) => main || dev) :\n            (({ main }) => main)\n    );\n}\n\nexport async function runGame(js) {\n    if (!window.isSecureContext) {\n        return { error: 'need https' };\n    }\n\n    if (!navigator.xr) {\n        return { error: 'WebXR not supported' };\n    }\n\n    const isSessionSupported = await navigator.xr.isSessionSupported('immersive-vr');\n\n    if (!isSessionSupported) {\n        return { error: 'VR in WebXR not supported' };\n    }\n\n    const session = await navigator.xr.requestSession('immersive-vr', {\n        optionalFeatures: ['local-floor', 'bounded-floor', 'hand-tracking', 'layers']\n    });\n\n    const jsModule = await import(/* webpackIgnore: true */js);\n\n    await jsModule.default.renderer.xr.setSession(session);\n\n    await new Promise(res => { session.addEventListener('end', res) });\n\n    return { ok: true };\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport { SecuritySandbox } from './SecuritySandbox';\nimport { Parent } from './Parent';\nimport { Sandboxed } from './Sandboxed';\n\nimport './index.css';\n\nReactDOM.render(\n  <React.StrictMode>\n    {process.env.NODE_ENV === 'development' ? <Sandboxed /> : <SecuritySandbox Parent={Parent} Sandboxed={Sandboxed} />}\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n","import React, { useState } from 'react';\nimport { CircularProgress, Box } from '@material-ui/core';\n\nimport { respawnFrame, useMessageHandler, sendMessage } from './SecuritySandbox';\n\nexport function Parent() {\n  const [preloaderVisible, setPreloaderVisible] = useState(false);\n  const [position, setPosition] = useState({ x: 0, y: 0 });\n\n  useMessageHandler(({ load, unload, setScrollTo, getScrollTo }) => {\n    if (preloaderVisible) {\n      if (unload) {\n        respawnFrame();\n        setPreloaderVisible(false);\n      }\n    } else {\n      if (load) {\n        setPreloaderVisible(true);\n      }\n\n      if (setScrollTo) {\n        setPosition(setScrollTo);\n      }\n    }\n\n    if (getScrollTo === true) {\n      sendMessage({ setScrollTo: position });\n    }\n  });\n\n  if (!preloaderVisible) {\n    return null;\n  }\n\n  return <div className=\"Parent\">\n    <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100%' }} onClick={() => {\n      respawnFrame();\n      setPreloaderVisible(false);\n    }}>\n      <CircularProgress />\n    </Box>\n  </div>;\n}\n","/* eslint-disable no-restricted-globals */\nimport React, { useEffect, useState } from 'react';\n\nimport { sendMessage, useMessageHandler } from './SecuritySandbox';\nimport { GameCards } from './GameCards';\n\nimport { getApps, filterApps, runGame } from './utils';\n\nexport function Sandboxed() {\n    const [apps, setApps] = useState(null);\n    useEffect(() => { getApps().then(filterApps).then(setApps); }, []);\n\n    useMessageHandler(({ setScrollTo }) => {\n        if (setScrollTo) {\n            window.scrollTo(setScrollTo.x, setScrollTo.y);\n        }\n    });\n\n    if (!apps) { return null; }\n\n    return <GameCards apps={apps} onPlay={async (js) => {\n        sendMessage({\n            load: true,\n            setScrollTo: { x: window.scrollX, y: window.scrollY }\n        });\n\n        const { error } = await runGame(js);\n        if (error) {\n            alert(error);\n        }\n\n        sendMessage({ unload: true });\n    }} />;\n}\n"],"sourceRoot":""}