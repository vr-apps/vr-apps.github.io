{"version":3,"sources":["SecuritySandbox.js","GameCard.js","utils.js","index.js","Parent.js","Sandboxed.js"],"names":["SecuritySandbox","Parent","Sandboxed","useEffect","window","parent","respawnFrame","Component","document","querySelector","remove","iframe","createElement","id","allow","sandbox","src","location","href","body","prepend","sendMessage","message","postMessage","origin","GameCard","app","name","developer","js","thumbnail","onPlay","Card","sx","maxWidth","CardActionArea","onClick","CardMedia","height","width","image","CardContent","Typography","gutterBottom","variant","component","color","a","fetch","res","text","parse","apps","runGame","isSecureContext","error","navigator","xr","isSessionSupported","requestSession","optionalFeatures","session","import","jsModule","default","renderer","setSession","Promise","addEventListener","ok","ReactDOM","render","StrictMode","handler","useState","preloaderVisible","setPreloaderVisible","load","unload","handleMessage","data","removeEventListener","className","Box","display","justifyContent","alignItems","CircularProgress","setApps","getApps","then","Grid","container","spacing","margin","map","i","item","alert","getElementById"],"mappings":"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","file":"static/js/main.148a8cac.chunk.js","sourcesContent":["/* eslint-disable no-restricted-globals */\nimport React, { useEffect } from 'react';\n\nexport function SecuritySandbox({ Parent, Sandboxed }) {\n    useEffect(() => {\n        if (window.parent === window) {\n            respawnFrame();\n        }\n    }, []);\n\n    const Component = window.parent === window ? Parent : Sandboxed;\n\n    return <Component />;\n}\n\nexport function respawnFrame() {\n    document.querySelector('#security-sandbox-iframe')?.remove();\n\n    const iframe = document.createElement('iframe');\n\n    iframe.id = 'security-sandbox-iframe';\n    iframe.allow = 'xr-spatial-tracking';\n    iframe.sandbox = 'allow-same-origin allow-scripts allow-modals'\n    iframe.src = window.location.href;\n\n    document.body.prepend(iframe);\n\n    return iframe;\n}\n\nexport function useMessageHandler(handler) {\n    useEffect(() => {\n        function handleMessage({ origin, data }) {\n            if (origin === window.location.origin) {\n                handler(data);\n            }\n        }\n\n        window.addEventListener('message', handleMessage);\n        return () => window.removeEventListener('message', handleMessage);\n    }, [handler]);\n}\n\nexport function sendMessage(message) {\n    const target = window.parent === window ? document.querySelector('#security-sandbox-iframe') : window.parent;\n\n    target.postMessage(message, window.location.origin);\n}\n","import React from 'react';\n\nimport { Card, CardMedia, CardActionArea, CardContent, Typography } from '@material-ui/core';\n\nexport function GameCard({ app: { name, developer, js, thumbnail }, onPlay }) {\n    return (\n        <Card sx={{ maxWidth: 345 }}>\n            <CardActionArea onClick={() => { onPlay(js) }}>\n                <CardMedia\n                    sx={{ height: 200, width: 300 }}\n                    image={thumbnail}\n                />\n                <CardContent>\n                    <Typography gutterBottom variant=\"h5\" component=\"div\">{name}</Typography>\n                    <Typography variant=\"body2\" color=\"text.secondary\">{developer}</Typography>\n                </CardContent>\n            </CardActionArea>\n        </Card>\n    )\n}","/* eslint-disable no-restricted-globals */\nimport { parse } from 'yaml';\n\nexport async function getApps() {\n    const res = await fetch('/vr-apps-catalog/apps.yml'), text = await res.text();\n    return parse(text).apps;\n}\n\nexport async function runGame(js) {\n    if (!window.isSecureContext) {\n        return { error: 'need https' };\n    }\n\n    if (!navigator.xr) {\n        return { error: 'WebXR not supported' };\n    }\n\n    const isSessionSupported = await navigator.xr.isSessionSupported('immersive-vr');\n\n    if (!isSessionSupported) {\n        return { error: 'VR in WebXR not supported' };\n    }\n\n    const session = await navigator.xr.requestSession('immersive-vr', {\n        optionalFeatures: ['local-floor', 'bounded-floor', 'hand-tracking', 'layers']\n    });\n\n    const jsModule = await import(/* webpackIgnore: true */js);\n\n    await jsModule.default.renderer.xr.setSession(session);\n\n    await new Promise(res => { session.addEventListener('end', res) });\n\n    return { ok: true };\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport { SecuritySandbox } from './SecuritySandbox';\nimport { Parent } from './Parent';\nimport { Sandboxed } from './Sandboxed';\n\nimport './index.css';\n\nReactDOM.render(\n  <React.StrictMode>\n    <SecuritySandbox Parent={Parent} Sandboxed={Sandboxed} />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n","import React, { useState } from 'react';\nimport { CircularProgress, Box } from '@material-ui/core';\n\nimport { respawnFrame, useMessageHandler } from './SecuritySandbox';\n\nexport function Parent() {\n  const [preloaderVisible, setPreloaderVisible] = useState(false);\n\n  useMessageHandler(({ load, unload }) => {\n    if (load) {\n      setPreloaderVisible(true);\n    }\n\n    if (unload) {\n      respawnFrame();\n      setPreloaderVisible(false);\n    }\n  });\n\n  if (!preloaderVisible) {\n    return null;\n  }\n\n  return <div className=\"Parent\">\n    <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100%' }} onClick={() => {\n      respawnFrame();\n      setPreloaderVisible(false);\n    }}>\n      <CircularProgress />\n    </Box>\n  </div>;\n}\n","import React, { useEffect, useState } from 'react';\nimport { Grid } from '@material-ui/core';\n\nimport { sendMessage } from './SecuritySandbox';\nimport { GameCard } from './GameCard';\n\nimport { getApps, runGame } from './utils';\n\nexport function Sandboxed() {\n    const [apps, setApps] = useState(null);\n    useEffect(() => { getApps().then(setApps); }, []);\n\n    if (!apps) { return null; }\n\n    return (<Grid container spacing={3} sx={{ margin: '0 auto' }}>{\n        apps.map((app, i) => <Grid item><GameCard app={app} key={i} onPlay={async (js) => {\n            sendMessage({ load: true });\n\n            const { error } = await runGame(js);\n            if (error) {\n                alert(error);\n            }\n\n            sendMessage({ unload: true });\n        }} /></Grid>)\n    }</Grid>);\n}\n"],"sourceRoot":""}