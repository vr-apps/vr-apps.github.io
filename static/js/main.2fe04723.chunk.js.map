{"version":3,"sources":["SecuritySandbox.js","GameCard.js","GameCards.js","utils.js","index.js","Parent.js","Sandboxed.js"],"names":["SecuritySandbox","Parent","Sandboxed","useEffect","window","parent","respawnFrame","Component","document","querySelector","remove","iframe","createElement","id","allow","sandbox","src","location","href","body","prepend","useMessageHandler","handler","handleMessage","data","addEventListener","removeEventListener","sendMessage","message","contentWindow","postMessage","GameCard","app","name","developer","js","thumbnail","onPlay","Card","sx","maxWidth","margin","CardActionArea","onClick","style","fontSize","position","top","left","CardMedia","height","width","image","CardContent","Typography","gutterBottom","variant","component","color","GameCards","apps","useLayoutEffect","getScrollTo","Grid","container","justifyContent","map","i","item","a","res","text","parse","fetch","processApps","filter","hash","main","dev","sort","b","rating","runGame","isSecureContext","error","navigator","xr","isSessionSupported","requestSession","optionalFeatures","session","import","jsmRaw","jsmExports","default","init","jsmData","renderer","setSession","Promise","ok","ReactDOM","render","StrictMode","useState","preloaderVisible","setPreloaderVisible","x","y","setPosition","load","unload","setScrollTo","className","Box","display","alignItems","CircularProgress","setApps","getApps","then","scrollTo","scrollX","scrollY","alert","getElementById"],"mappings":"qMAGO,SAASA,EAAT,GAAiD,IAAtBC,EAAqB,EAArBA,OAAQC,EAAa,EAAbA,UACtCC,qBAAU,WACFC,OAAOC,SAAWD,QAClBE,MAEL,IAEH,IAAMC,EAAYH,OAAOC,SAAWD,OAASH,EAASC,EAEtD,OAAO,cAACK,EAAD,IAGJ,SAASD,IAAgB,IAAD,EAC3B,UAAAE,SAASC,cAAc,mCAAvB,SAAoDC,SAEpD,IAAMC,EAASH,SAASI,cAAc,UAStC,OAPAD,EAAOE,GAAK,0BACZF,EAAOG,MAAQ,sBACfH,EAAOI,QAAU,6BACjBJ,EAAOK,IAAMZ,OAAOa,SAASC,KAE7BV,SAASW,KAAKC,QAAQT,GAEfA,EAGJ,SAASU,EAAkBC,GAC9BnB,qBAAU,WACN,SAASoB,EAAT,GAAkC,IAATC,EAAQ,EAARA,KACrBF,EAAQE,GAIZ,OADApB,OAAOqB,iBAAiB,UAAWF,GAC5B,kBAAMnB,OAAOsB,oBAAoB,UAAWH,MACpD,CAACD,IAGD,SAASK,EAAYC,IAGTxB,OAAOC,SAAWD,OAASI,SAASC,cAAc,4BAA4BoB,cAAgBzB,OAAOC,QAE7GyB,YAAYF,EAAS,K,yGC3CzB,SAASG,EAAT,GAAwE,IAAD,IAAnDC,IAAOC,EAA4C,EAA5CA,KAAMC,EAAsC,EAAtCA,UAAWC,EAA2B,EAA3BA,GAAIC,EAAuB,EAAvBA,UAAaC,EAAU,EAAVA,OAChE,OACI,cAACC,EAAA,EAAD,CAAMC,GAAI,CAAEC,SAAU,IAAKC,OAAQ,QAAnC,SACI,eAACC,EAAA,EAAD,CAAgBC,QAAS,WAAQN,EAAOF,IAAxC,UACI,sBAAMS,MAAO,CACTC,SAAU,OACVC,SAAU,WACVC,IAAK,qBACLC,KAAM,sBAJV,0BAMA,cAACC,EAAA,EAAD,CACIV,GAAI,CAAEW,OAAQ,IAAKC,MAAO,KAC1BC,MAAOhB,IAEX,eAACiB,EAAA,EAAD,WACI,cAACC,EAAA,EAAD,CAAYC,cAAY,EAACC,QAAQ,KAAKC,UAAU,MAAhD,SAAuDxB,IACvD,cAACqB,EAAA,EAAD,CAAYE,QAAQ,QAAQE,MAAM,iBAAlC,SAAoDxB,YCZjE,SAASyB,EAAT,GAAsC,IAAjBC,EAAgB,EAAhBA,KAAMvB,EAAU,EAAVA,OAK9B,OAJAwB,2BAAgB,WACZlC,EAAY,CAAEmC,aAAa,MAC5B,IAEK,cAACC,EAAA,EAAD,CAAMC,WAAS,EAACC,eAAe,SAA/B,SACJL,EAAKM,KAAI,SAAClC,EAAKmC,GAAN,OAAY,cAACJ,EAAA,EAAD,CAAMK,MAAI,EAAV,SAAmB,cAACrC,EAAD,CAAUC,IAAKA,EAAKK,OAAQA,KAA/B8B,Q,wDCVtC,kCAAAE,EAAA,mFAEOC,EAFP,gBAE6FA,EAAIC,OAFjG,cAEgFA,EAFhF,yBAGQC,gBAAMD,GAAMX,KAAKM,KAAI,SAAAE,GAGxB,OAFAA,EAAKjC,GAAK,4BAA8BiC,EAAKjC,GAC7CiC,EAAKhC,UAAY,4BAA8BgC,EAAKhC,UAC7CgC,MANZ,wBAUeK,MAAM,6BAVrB,eAUGH,EAVH,iBAUgEA,EAAIC,OAVpE,eAUmDA,EAVnD,yBAWIC,gBAAMD,GAAMX,MAXhB,6C,sBAcA,SAASc,EAAYd,GACxB,OAAOA,EAAKe,OACU,SAAlB1D,SAAS2D,KACJ,gBAAGC,EAAH,EAAGA,KAAMC,EAAT,EAASA,IAAT,OAAmBD,GAAQC,GAC3B,qBAAGD,OACVE,MAAK,SAACV,EAAGW,GAAJ,OAAUX,EAAEY,OAASD,EAAEC,QAAU,EAAI,KAGzC,SAAeC,EAAtB,kC,4CAAO,WAAuB/C,GAAvB,qBAAAkC,EAAA,yDACEjE,OAAO+E,gBADT,yCAEQ,CAAEC,MAAO,eAFjB,UAKEC,UAAUC,GALZ,yCAMQ,CAAEF,MAAO,wBANjB,uBAS8BC,UAAUC,GAAGC,mBAAmB,gBAT9D,0DAYQ,CAAEH,MAAO,8BAZjB,wBAemBC,UAAUC,GAAGE,eAAe,eAAgB,CAC9DC,iBAAkB,CAAC,cAAe,gBAAiB,gBAAiB,YAhBrE,eAeGC,EAfH,iBAmBkBC,OAAgCxD,GAnBlD,WAmBGyD,EAnBH,SAoBGC,EAAaD,EAAOE,SAAWF,GACVG,KArBxB,kCAqBsCF,EAAWE,OArBjD,iDAqB2DF,EArB3D,eAqBGG,EArBH,eAuBGA,EAAQC,SAASX,GAAGY,WAAWR,GAvBlC,yBAyBG,IAAIS,SAAQ,SAAA7B,GAASoB,EAAQjE,iBAAiB,MAAO6C,MAzBxD,iCA2BI,CAAE8B,IAAI,IA3BV,6C,4BChBPC,IAASC,OACP,cAAC,IAAMC,WAAP,UAC4D,cAACvG,EAAD,CAAiBC,OCNxE,WACL,MAAgDuG,oBAAS,GAAzD,mBAAOC,EAAP,KAAyBC,EAAzB,KACA,EAAgCF,mBAAS,CAAEG,EAAG,EAAGC,EAAG,IAApD,mBAAO9D,EAAP,KAAiB+D,EAAjB,KAuBA,OArBAxF,GAAkB,YAAiD,IAA9CyF,EAA6C,EAA7CA,KAAMC,EAAuC,EAAvCA,OAAQC,EAA+B,EAA/BA,YAAalD,EAAkB,EAAlBA,YAC1C2C,EACEM,IACFzG,IACAoG,GAAoB,KAGlBI,GACFJ,GAAoB,GAGlBM,GACFH,EAAYG,KAII,IAAhBlD,GACFnC,EAAY,CAAEqF,YAAalE,OAI1B2D,EAIE,qBAAKQ,UAAU,SAAf,SACL,cAACC,EAAA,EAAD,CAAK3E,GAAI,CAAE4E,QAAS,OAAQlD,eAAgB,SAAUmD,WAAY,SAAUlE,OAAQ,QAAUP,QAAS,WACrGrC,IACAoG,GAAoB,IAFtB,SAIE,cAACW,EAAA,EAAD,QARK,MDpBoFnH,UEHxF,WACH,MAAwBsG,mBAAS,MAAjC,mBAAO5C,EAAP,KAAa0D,EAAb,KASA,OARAnH,qBAAU,YHPP,WAAP,gCGOsBoH,GAAUC,KAAK9C,GAAa8C,KAAKF,KAAa,IAEhEjG,GAAkB,YAAsB,IAAnB2F,EAAkB,EAAlBA,YACbA,GACA5G,OAAOqH,SAAST,EAAYL,EAAGK,EAAYJ,MAI9ChD,EAEE,cAACD,EAAD,CAAWC,KAAMA,EAAMvB,OAAM,uCAAE,WAAOF,GAAP,iBAAAkC,EAAA,6DAClC1C,EAAY,CACRmF,MAAM,EACNE,YAAa,CAAEL,EAAGvG,OAAOsH,QAASd,EAAGxG,OAAOuH,WAHd,SAMVzC,EAAQ/C,GANE,iBAM1BiD,EAN0B,EAM1BA,QAEJwC,MAAMxC,GAGVzD,EAAY,CAAEoF,QAAQ,IAXY,2CAAF,wDAFhB,UFLtBvG,SAASqH,eAAe,W","file":"static/js/main.2fe04723.chunk.js","sourcesContent":["/* eslint-disable no-restricted-globals */\nimport React, { useEffect } from 'react';\n\nexport function SecuritySandbox({ Parent, Sandboxed }) {\n    useEffect(() => {\n        if (window.parent === window) {\n            respawnFrame();\n        }\n    }, []);\n\n    const Component = window.parent === window ? Parent : Sandboxed;\n\n    return <Component />;\n}\n\nexport function respawnFrame() {\n    document.querySelector('#security-sandbox-iframe')?.remove();\n\n    const iframe = document.createElement('iframe');\n\n    iframe.id = 'security-sandbox-iframe';\n    iframe.allow = 'xr-spatial-tracking';\n    iframe.sandbox = 'allow-scripts allow-modals'\n    iframe.src = window.location.href;\n\n    document.body.prepend(iframe);\n\n    return iframe;\n}\n\nexport function useMessageHandler(handler) {\n    useEffect(() => {\n        function handleMessage({ data }) {\n            handler(data);\n        }\n\n        window.addEventListener('message', handleMessage);\n        return () => window.removeEventListener('message', handleMessage);\n    }, [handler]);\n}\n\nexport function sendMessage(message) {\n    if (process.env.NODE_ENV === 'development') { return; }\n\n    const target = window.parent === window ? document.querySelector('#security-sandbox-iframe').contentWindow : window.parent;\n\n    target.postMessage(message, '*');\n}\n","import React from 'react';\nimport { Card, CardMedia, CardActionArea, CardContent, Typography } from '@material-ui/core';\n\nexport function GameCard({ app: { name, developer, js, thumbnail }, onPlay }) {\n    return (\n        <Card sx={{ maxWidth: 345, margin: \"12px\" }}>\n            <CardActionArea onClick={() => { onPlay(js) }}>\n                <span style={{\n                    fontSize: \"70px\",\n                    position: \"absolute\",\n                    top: \"calc(100px - 35px)\",\n                    left: \"calc(150px - 35px)\"\n                }}>▶️</span>\n                <CardMedia\n                    sx={{ height: 200, width: 300 }}\n                    image={thumbnail}\n                />\n                <CardContent>\n                    <Typography gutterBottom variant=\"h5\" component=\"div\">{name}</Typography>\n                    <Typography variant=\"body2\" color=\"text.secondary\">{developer}</Typography>\n                </CardContent>\n            </CardActionArea>\n        </Card>\n    )\n}\n","/* eslint-disable no-restricted-globals */\nimport React, { useLayoutEffect } from 'react';\nimport { Grid } from '@material-ui/core';\n\nimport { sendMessage } from './SecuritySandbox';\nimport { GameCard } from './GameCard';\n\nexport function GameCards({ apps, onPlay }) {\n    useLayoutEffect(() => {\n        sendMessage({ getScrollTo: true });\n    }, []);\n\n    return (<Grid container justifyContent=\"center\">{\n        apps.map((app, i) => <Grid item key={i}><GameCard app={app} onPlay={onPlay} /></Grid>)\n    }</Grid>);\n}\n","/* eslint-disable no-restricted-globals */\nimport { parse } from 'yaml';\n\nexport async function getApps() {\n    if (process.env.NODE_ENV === 'development') {\n        const res = await fetch('https://vr-apps.github.io/vr-apps-catalog/apps.yml'), text = await res.text();\n        return parse(text).apps.map(item => {\n            item.js = 'https://vr-apps.github.io' + item.js;\n            item.thumbnail = 'https://vr-apps.github.io' + item.thumbnail;\n            return item;\n        });\n    }\n\n    const res = await fetch('/vr-apps-catalog/apps.yml'), text = await res.text();\n    return parse(text).apps;\n}\n\nexport function processApps(apps) {\n    return apps.filter(\n        location.hash === '#dev' ?\n            (({ main, dev }) => main || dev) :\n            (({ main }) => main)\n    ).sort((a, b) => a.rating > b.rating ? -1 : 1);\n}\n\nexport async function runGame(js) {\n    if (!window.isSecureContext) {\n        return { error: 'need https' };\n    }\n\n    if (!navigator.xr) {\n        return { error: 'WebXR not supported' };\n    }\n\n    const isSessionSupported = await navigator.xr.isSessionSupported('immersive-vr');\n\n    if (!isSessionSupported) {\n        return { error: 'VR in WebXR not supported' };\n    }\n\n    const session = await navigator.xr.requestSession('immersive-vr', {\n        optionalFeatures: ['local-floor', 'bounded-floor', 'hand-tracking', 'layers']\n    });\n\n    const jsmRaw = await import(/* webpackIgnore: true */js);\n    const jsmExports = jsmRaw.default || jsmRaw;\n    const jsmData = jsmExports.init ? (await jsmExports.init()) : jsmExports;\n\n    await jsmData.renderer.xr.setSession(session);\n\n    await new Promise(res => { session.addEventListener('end', res) });\n\n    return { ok: true };\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport { SecuritySandbox } from './SecuritySandbox';\nimport { Parent } from './Parent';\nimport { Sandboxed } from './Sandboxed';\n\nimport './index.css';\n\nReactDOM.render(\n  <React.StrictMode>\n    {process.env.NODE_ENV === 'development' ? <Sandboxed /> : <SecuritySandbox Parent={Parent} Sandboxed={Sandboxed} />}\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n","import React, { useState } from 'react';\nimport { CircularProgress, Box } from '@material-ui/core';\n\nimport { respawnFrame, useMessageHandler, sendMessage } from './SecuritySandbox';\n\nexport function Parent() {\n  const [preloaderVisible, setPreloaderVisible] = useState(false);\n  const [position, setPosition] = useState({ x: 0, y: 0 });\n\n  useMessageHandler(({ load, unload, setScrollTo, getScrollTo }) => {\n    if (preloaderVisible) {\n      if (unload) {\n        respawnFrame();\n        setPreloaderVisible(false);\n      }\n    } else {\n      if (load) {\n        setPreloaderVisible(true);\n      }\n\n      if (setScrollTo) {\n        setPosition(setScrollTo);\n      }\n    }\n\n    if (getScrollTo === true) {\n      sendMessage({ setScrollTo: position });\n    }\n  });\n\n  if (!preloaderVisible) {\n    return null;\n  }\n\n  return <div className=\"Parent\">\n    <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100%' }} onClick={() => {\n      respawnFrame();\n      setPreloaderVisible(false);\n    }}>\n      <CircularProgress />\n    </Box>\n  </div>;\n}\n","/* eslint-disable no-restricted-globals */\nimport React, { useEffect, useState } from 'react';\n\nimport { sendMessage, useMessageHandler } from './SecuritySandbox';\nimport { GameCards } from './GameCards';\n\nimport { getApps, processApps, runGame } from './utils';\n\nexport function Sandboxed() {\n    const [apps, setApps] = useState(null);\n    useEffect(() => { getApps().then(processApps).then(setApps); }, []);\n\n    useMessageHandler(({ setScrollTo }) => {\n        if (setScrollTo) {\n            window.scrollTo(setScrollTo.x, setScrollTo.y);\n        }\n    });\n\n    if (!apps) { return null; }\n\n    return <GameCards apps={apps} onPlay={async (js) => {\n        sendMessage({\n            load: true,\n            setScrollTo: { x: window.scrollX, y: window.scrollY }\n        });\n\n        const { error } = await runGame(js);\n        if (error) {\n            alert(error);\n        }\n\n        sendMessage({ unload: true });\n    }} />;\n}\n"],"sourceRoot":""}